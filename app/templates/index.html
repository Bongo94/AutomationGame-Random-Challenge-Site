{# app/templates/index.html #}
{% extends "base.html" %}
{% from "_macros.html" import render_category_settings %} {# Импорт макроса остается #}

{% block title %}Генератор Челленджей Automation{% endblock %}

{% block content %}
    <h1 class="mb-4 text-center">Генератор Челленджей для Automation</h1>

    {# Форма генерации #}
    <form action="{{ url_for('main.generate_challenge') }}" method="post" class="mb-4 p-4 border rounded bg-light">
        {# Выпадающий список шаблонов #}
        <div class="mb-3">
            <label for="template_select" class="form-label">Выберите шаблон:</label>
            <select name="template_id" id="template_select" class="form-select">
                <option value="custom" {% if selected_template_id == 'custom' %}selected{% endif %}>-- Кастомный --</option>
                {% for template in templates %}
                <option value="{{ template.id }}" {% if selected_template_id == template.id|string %}selected{% endif %}>{{ template.name }}</option>
                {% else %}
                <option value="" disabled>Шаблоны не найдены</option>
                {% endfor %}
            </select>
        </div>

        {# Кастомные настройки (используем макрос) #}
        <div id="custom_settings" style="display: none;">
             <h4>Настройка Кастомного Челленджа:</h4>
             <p class="text-muted"><small>Отметьте категории, которые нужно включить в генерацию, и настройте правила.</small></p>
             {% if all_categories %}
                {% for category in all_categories %}
                    {{ render_category_settings(category, form_data) }}
                {% endfor %}
             {% else %}
                <p class="text-muted">Нет доступных категорий для настройки.</p>
             {% endif %}
        </div>

        {# Кнопка генерации #}
        <button type="submit" class="btn btn-primary w-100 mt-3"> <i class="bi bi-dice-5"></i> Сгенерировать Челлендж!</button>
    </form>

    {# Отображение результата #}
    {% if result %}
    <div class="challenge-result border rounded p-4 bg-white">
        <h2 class="mb-3">Результат Генерации:</h2>
        {% for category, values in result.items() %}
            <div class="result-item mb-2">
                <strong>{{ category | replace('_', ' ') | title }}:</strong>
                <span>{{ values | join(', ') }}</span>
            </div>
        {% else %}
            <p class="text-muted">Результат генерации пуст.</p>
        {% endfor %}
        <hr>
        <button onclick="copyResultToClipboard()" class="btn btn-secondary btn-sm"> <i class="bi bi-clipboard"></i> Копировать результат</button>
        <pre id="raw_result" style="display: none;">{{ result | tojson(indent=2) }}</pre>
    </div>
    {% endif %}
{% endblock %}

{# Если для этой страницы нужны особые скрипты, их можно добавить сюда #}
{% block scripts %}
    {# Например: <script>...</script> #}
{% endblock %}